"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var dom=require("@zcorky/dom"),_regeneratorRuntime=_interopDefault(require("babel-runtime/regenerator")),MOBILE_EVENTS=["touchstart","touchmove","touchend","touchcancel"];function getLen(e){return Math.sqrt(e.x*e.x+e.y*e.y)}function dot(e,t){return e.x*t.x+e.y*t.y}function getAngle(e,t){var n=getLen(e)*getLen(t);if(0===n)return 0;var i=dot(e,t)/n;return i>1&&(i=1),Math.acos(i)}function cross(e,t){return e.x*t.y-t.x*e.y}function getRotateAngle(e,t){var n=getAngle(e,t);return cross(e,t)>0&&(n*=-1),180*n/Math.PI}var HandlerAdmin=function(e){this.handlers=[],this.el=e};function wrapFunc(e,t){var n=new HandlerAdmin(e);return n.add(t),n}HandlerAdmin.prototype.add=function(e){this.handlers.push(e)},HandlerAdmin.prototype.del=function(e){e||(this.handlers=[]);for(var t=this.handlers.length;t>=0;t--)this.handlers[t]===e&&this.handlers.splice(t,1)},HandlerAdmin.prototype.dispatch=function(){for(var e=0,t=this.handlers.length;e<t;e++){var n=this.handlers[e];"function"==typeof n&&n.apply(this.el,arguments)}};var AlloyFinger=function(e,t){this.element="string"==typeof e?document.querySelector(e):e,this.start=this.start.bind(this),this.move=this.move.bind(this),this.end=this.end.bind(this),this.cancel=this.cancel.bind(this),this.element.addEventListener("touchstart",this.start,!1),this.element.addEventListener("touchmove",this.move,!1),this.element.addEventListener("touchend",this.end,!1),this.element.addEventListener("touchcancel",this.cancel,!1),this.element.addEventListener("mousedown",this.start,!1),this.element.addEventListener("mousemove",this.move,!1),this.element.addEventListener("mouseup",this.end,!1),this.preV={x:null,y:null},this.pinchStartLen=null,this.zoom=1,this.isDoubleTap=!1;var n=function(){};this.rotate=wrapFunc(this.element,t.rotate||n),this.touchStart=wrapFunc(this.element,t.touchStart||n),this.multipointStart=wrapFunc(this.element,t.multipointStart||n),this.multipointEnd=wrapFunc(this.element,t.multipointEnd||n),this.pinch=wrapFunc(this.element,t.pinch||n),this.swipe=wrapFunc(this.element,t.swipe||n),this.tap=wrapFunc(this.element,t.tap||n),this.doubleTap=wrapFunc(this.element,t.doubleTap||n),this.longTap=wrapFunc(this.element,t.longTap||n),this.singleTap=wrapFunc(this.element,t.singleTap||n),this.pressMove=wrapFunc(this.element,t.pressMove||n),this.twoFingerPressMove=wrapFunc(this.element,t.twoFingerPressMove||n),this.touchMove=wrapFunc(this.element,t.touchMove||n),this.touchEnd=wrapFunc(this.element,t.touchEnd||n),this.touchCancel=wrapFunc(this.element,t.touchCancel||n),this._cancelAllHandler=this.cancelAll.bind(this),window.addEventListener("scroll",this._cancelAllHandler),this.moving=!1,this.delta=null,this.last=null,this.now=null,this.tapTimeout=null,this.singleTapTimeout=null,this.longTapTimeout=null,this.swipeTimeout=null,this.x1=this.x2=this.y1=this.y2=null,this.preTapPosition={x:null,y:null}};AlloyFinger.prototype={start:function(e){if(!this.moving){this.moving=!0;var t=e.targetTouches||e.touches;if(-1===MOBILE_EVENTS.indexOf(event.type)&&(t=[e]),t){this.now=Date.now(),this.x1=t[0].pageX,this.y1=t[0].pageY,this.delta=this.now-(this.last||this.now),this.touchStart.dispatch(e,this.element),null!==this.preTapPosition.x&&(this.isDoubleTap=this.delta>0&&this.delta<=250&&Math.abs(this.preTapPosition.x-this.x1)<30&&Math.abs(this.preTapPosition.y-this.y1)<30,this.isDoubleTap&&clearTimeout(this.singleTapTimeout)),this.preTapPosition.x=this.x1,this.preTapPosition.y=this.y1,this.last=this.now;var n=this.preV;if(t.length>1){this._cancelLongTap(),this._cancelSingleTap();var i={x:t[1].pageX-this.x1,y:t[1].pageY-this.y1};n.x=i.x,n.y=i.y,this.pinchStartLen=getLen(n),this.multipointStart.dispatch(e,this.element)}this._preventTap=!1,this.longTapTimeout=setTimeout(function(){this.longTap.dispatch(e,this.element),this._preventTap=!0}.bind(this),750)}}},move:function(e){if(this.moving){var t=e.targetTouches||e.touches;if(-1===MOBILE_EVENTS.indexOf(event.type)&&(t=[e]),t){var n=this.preV,i=t.length,s=t[0].pageX,o=t[0].pageY;if(this.isDoubleTap=!1,i>1){var a=t[1].pageX,r=t[1].pageY,l={x:t[1].pageX-s,y:t[1].pageY-o};null!==n.x&&(this.pinchStartLen>0&&(e.zoom=getLen(l)/this.pinchStartLen,this.pinch.dispatch(e,this.element)),e.angle=getRotateAngle(l,n),this.rotate.dispatch(e,this.element)),n.x=l.x,n.y=l.y,null!==this.x2&&null!==this.sx2?(e.deltaX=(s-this.x2+a-this.sx2)/2,e.deltaY=(o-this.y2+r-this.sy2)/2):(e.deltaX=0,e.deltaY=0),this.twoFingerPressMove.dispatch(e,this.element),this.sx2=a,this.sy2=r}else{if(null!==this.x2){e.deltaX=s-this.x2,e.deltaY=o-this.y2;var c=Math.abs(this.x1-this.x2),h=Math.abs(this.y1-this.y2);(c>10||h>10)&&(this._preventTap=!0)}else e.deltaX=0,e.deltaY=0;this.pressMove.dispatch(e,this.element)}this.touchMove.dispatch(e,this.element),this._cancelLongTap(),this.x2=s,this.y2=o,i>1&&e.preventDefault()}}},end:function(e){if(this.moving){this.moving=!1;var t=e.targetTouches||e.touches,n=e.changedTouches;if(-1===MOBILE_EVENTS.indexOf(event.type)&&(t=[e],n=[e]),n){this._cancelLongTap();var i=this;t.length<2&&(this.multipointEnd.dispatch(e,this.element),this.sx2=this.sy2=null),this.x2&&Math.abs(this.x1-this.x2)>30||this.y2&&Math.abs(this.y1-this.y2)>30?(e.direction=this._swipeDirection(this.x1,this.x2,this.y1,this.y2),this.swipeTimeout=setTimeout(function(){i.swipe.dispatch(e,i.element)},0)):(this.tapTimeout=setTimeout(function(){i._preventTap||i.tap.dispatch(e,i.element),i.isDoubleTap&&(i.doubleTap.dispatch(e,i.element),i.isDoubleTap=!1)},0),i.isDoubleTap||(i.singleTapTimeout=setTimeout(function(){i.singleTap.dispatch(e,i.element)},250))),this.touchEnd.dispatch(e,this.element),this.preV.x=0,this.preV.y=0,this.zoom=1,this.pinchStartLen=null,this.x1=this.x2=this.y1=this.y2=null}}},cancelAll:function(){this._preventTap=!0,clearTimeout(this.singleTapTimeout),clearTimeout(this.tapTimeout),clearTimeout(this.longTapTimeout),clearTimeout(this.swipeTimeout)},cancel:function(e){this.cancelAll(),this.touchCancel.dispatch(e,this.element)},_cancelLongTap:function(){clearTimeout(this.longTapTimeout)},_cancelSingleTap:function(){clearTimeout(this.singleTapTimeout)},_swipeDirection:function(e,t,n,i){return Math.abs(e-t)>=Math.abs(n-i)?e-t>0?"Left":"Right":n-i>0?"Up":"Down"},on:function(e,t){this[e]&&this[e].add(t)},off:function(e,t){this[e]&&this[e].del(t)},destroy:function(){return this.singleTapTimeout&&clearTimeout(this.singleTapTimeout),this.tapTimeout&&clearTimeout(this.tapTimeout),this.longTapTimeout&&clearTimeout(this.longTapTimeout),this.swipeTimeout&&clearTimeout(this.swipeTimeout),this.element.removeEventListener("touchstart",this.start),this.element.removeEventListener("touchmove",this.move),this.element.removeEventListener("touchend",this.end),this.element.removeEventListener("touchcancel",this.cancel),this.element.removeEventListener("mousedown",this.start),this.element.removeEventListener("mousemove",this.move),this.element.removeEventListener("mouseup",this.end),this.rotate.del(),this.touchStart.del(),this.multipointStart.del(),this.multipointEnd.del(),this.pinch.del(),this.swipe.del(),this.tap.del(),this.doubleTap.del(),this.longTap.del(),this.singleTap.del(),this.pressMove.del(),this.twoFingerPressMove.del(),this.touchMove.del(),this.touchEnd.del(),this.touchCancel.del(),this.preV=this.pinchStartLen=this.zoom=this.isDoubleTap=this.delta=this.last=this.now=this.tapTimeout=this.singleTapTimeout=this.longTapTimeout=this.swipeTimeout=this.x1=this.x2=this.y1=this.y2=this.preTapPosition=this.rotate=this.touchStart=this.multipointStart=this.multipointEnd=this.pinch=this.swipe=this.tap=this.doubleTap=this.longTap=this.singleTap=this.pressMove=this.touchMove=this.touchEnd=this.touchCancel=this.twoFingerPressMove=null,window.removeEventListener("scroll",this._cancelAllHandler),null}};var Matrix3D=function(e,t,n,i,s,o,a,r,l,c,h,p,u,d,m,v){this.elements=window.Float32Array?new Float32Array(16):[];var w=this.elements;w[0]=void 0!==e?e:1,w[4]=t||0,w[8]=n||0,w[12]=i||0,w[1]=s||0,w[5]=void 0!==o?o:1,w[9]=a||0,w[13]=r||0,w[2]=l||0,w[6]=c||0,w[10]=void 0!==h?h:1,w[14]=p||0,w[3]=u||0,w[7]=d||0,w[11]=m||0,w[15]=void 0!==v?v:1};function observe(e,t,n){for(var i=0,s=t.length;i<s;i++){watch(e,t[i],n)}}function watch(e,t,n){Object.defineProperty(e,t,{get:function(){return this["__"+t]},set:function(e){e!==this["__"+t]&&(this["__"+t]=e,n())}})}Matrix3D.DEG_TO_RAD=Math.PI/180,Matrix3D.prototype={set:function(e,t,n,i,s,o,a,r,l,c,h,p,u,d,m,v){var w=this.elements;return w[0]=e,w[4]=t,w[8]=n,w[12]=i,w[1]=s,w[5]=o,w[9]=a,w[13]=r,w[2]=l,w[6]=c,w[10]=h,w[14]=p,w[3]=u,w[7]=d,w[11]=m,w[15]=v,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},multiplyMatrices:function(e,t){var n=e.elements,i=this.elements,s=n[0],o=n[4],a=n[8],r=n[12],l=n[1],c=n[5],h=n[9],p=n[13],u=n[2],d=n[6],m=n[10],v=n[14],w=n[3],f=n[7],g=n[11],y=n[15],T=t[0],x=t[1],b=t[2],k=t[3],E=t[4],_=t[5],M=t[6],A=t[7],C=t[8],S=t[9],D=t[10],L=t[11],X=t[12],$=t[13],F=t[14],Y=t[15];return i[0]=s*T+o*E+a*C+r*X,i[4]=s*x+o*_+a*S+r*$,i[8]=s*b+o*M+a*D+r*F,i[12]=s*k+o*A+a*L+r*Y,i[1]=l*T+c*E+h*C+p*X,i[5]=l*x+c*_+h*S+p*$,i[9]=l*b+c*M+h*D+p*F,i[13]=l*k+c*A+h*L+p*Y,i[2]=u*T+d*E+m*C+v*X,i[6]=u*x+d*_+m*S+v*$,i[10]=u*b+d*M+m*D+v*F,i[14]=u*k+d*A+m*L+v*Y,i[3]=w*T+f*E+g*C+y*X,i[7]=w*x+f*_+g*S+y*$,i[11]=w*b+f*M+g*D+y*F,i[15]=w*k+f*A+g*L+y*Y,this},_rounded:function(e,t){return t=Math.pow(10,t||15),Math.round(e*t)/t},appendTransform:function(e,t,n,i,s,o,a,r,l,c,h,p,u,d){var m=a*Matrix3D.DEG_TO_RAD,v=this._rounded(Math.cos(m)),w=this._rounded(Math.sin(m)),f=r*Matrix3D.DEG_TO_RAD,g=this._rounded(Math.cos(f)),y=this._rounded(Math.sin(f)),T=l*Matrix3D.DEG_TO_RAD,x=this._rounded(Math.cos(-1*T)),b=this._rounded(Math.sin(-1*T));return this.multiplyMatrices(this,[1,0,0,e,0,v,w,t,0,-w,v,n,0,0,0,1]),this.multiplyMatrices(this,[g,0,y,0,0,1,0,0,-y,0,g,0,0,0,0,1]),this.multiplyMatrices(this,[x*i,b*s,0,0,-b*i,x*s,0,0,0,0,1*o,0,0,0,0,1]),(c||h)&&this.multiplyMatrices(this,[this._rounded(Math.cos(c*Matrix3D.DEG_TO_RAD)),this._rounded(Math.sin(c*Matrix3D.DEG_TO_RAD)),0,0,-1*this._rounded(Math.sin(h*Matrix3D.DEG_TO_RAD)),this._rounded(Math.cos(h*Matrix3D.DEG_TO_RAD)),0,0,0,0,1,0,0,0,0,1]),(p||u||d)&&(this.elements[12]-=p*this.elements[0]+u*this.elements[4]+d*this.elements[8],this.elements[13]-=p*this.elements[1]+u*this.elements[5]+d*this.elements[9],this.elements[14]-=p*this.elements[2]+u*this.elements[6]+d*this.elements[10]),this}};var Transform=function(e,t){observe(e,["translateX","translateY","translateZ","scaleX","scaleY","scaleZ","rotateX","rotateY","rotateZ","skewX","skewY","originX","originY","originZ"],function(){var n=e.matrix3D.identity().appendTransform(e.translateX,e.translateY,e.translateZ,e.scaleX,e.scaleY,e.scaleZ,e.rotateX,e.rotateY,e.rotateZ,e.skewX,e.skewY,e.originX,e.originY,e.originZ);e.style.transform=e.style.msTransform=e.style.OTransform=e.style.MozTransform=e.style.webkitTransform=(t?"":"perspective("+(void 0===e.perspective?500:e.perspective)+"px) ")+"matrix3d("+Array.prototype.slice.call(n.elements).join(",")+")"}),e.matrix3D=new Matrix3D,t||(observe(e,["perspective"],function(){e.style.transform=e.style.msTransform=e.style.OTransform=e.style.MozTransform=e.style.webkitTransform="perspective("+e.perspective+"px) matrix3d("+Array.prototype.slice.call(e.matrix3D.elements).join(",")+")"}),e.perspective=500),e.scaleX=e.scaleY=e.scaleZ=1,e.translateX=e.translateY=e.translateZ=e.rotateX=e.rotateY=e.rotateZ=e.skewX=e.skewY=e.originX=e.originY=e.originZ=0};!function(){for(var e=0,t=["webkit","moz"],n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t){var n=(new Date).getTime(),i=Math.max(0,16-(n-e)),s=window.setTimeout(function(){t(n+i)},i);return e=n+i,s}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}();var To=function e(t,n,i,s,o,a,r){var l=t[n],c=i-l,h=new Date,p=this,u=o||function(e){return e};this.tickID=null;!function e(){var o=new Date-h;if(o>=s)return t[n]=i,r&&r(i),a&&a(i),cancelAnimationFrame(p.tickID),void(p.toTick=null);t[n]=c*u(o/s)+l,p.tickID=requestAnimationFrame(e),r&&r(t[n])}(),e.List.push(this)};function maxImage(e){return e.width>=e.height?{auto:"height",max:"width"}:{auto:"width",max:"height"}}function ease(e){return Math.sqrt(1-Math.pow(e-1,2))}function createBodyScrollable(){var e=document.body.style.overflow;return{enable:function(){dom.setStyle(document.body,"overflow",e)},disable:function(){dom.setStyle(document.body,"overflow","hidden")}}}To.List=[],To.stopAll=function(){for(var e=0,t=To.List.length;e<t;e++)cancelAnimationFrame(To.List[e].tickID);To.List.length=0},To.stop=function(e){cancelAnimationFrame(e.tickID)},To.reset=function(e,t,n){e[t]=n};var innerHTML='\n<style>\n.zcorky-loading-container {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate3d(-50%, -50%, 0);\n  z-index: -10;\n}\n.zcorky-wrapper {\n  width: 50px;\n  height: 50px;\n}\n\n.rotate {\n  animation: zcorky-rotate 1s linear infinite;\n}\n\n@keyframes zcorky-rotate {\n  to {\n    transform: rotate(1turn);\n  }\n}\n</style>\n<svg class="zcorky-wrapper" viewBox="-25 -25 50 50">\n  <circle cx="0" cy="0" r="20" stroke="#f0f0f0" fill="none" stroke-width="3px" style="opacity: 0.4"></circle>\n  <circle cx="0" cy="0" r="20" stroke="#f0f0f0" fill="none" stroke-width="3px" stroke-dasharray="20 150" class="rotate"></circle>\n</svg>\n',createLoading=function(){var e=document.createElement("div");return e.innerHTML=innerHTML,e.classList.add("zcorky-loading-container"),e};function _asyncToGenerator(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){return function i(s,o){try{var a=t[s](o),r=a.value}catch(e){return void n(e)}if(!a.done)return Promise.resolve(r).then(function(e){i("next",e)},function(e){i("throw",e)});e(r)}("next")})}}var download=function(){var e=_asyncToGenerator(_regeneratorRuntime.mark(function e(t,n){var i,s,o,a,r,l,c,h;return _regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=(i=n||{}).filename||+new Date,o=i.method||"GET",a=i.headers||{},r=i.body||void 0,e.next=7,fetch(t,{method:o,headers:a,body:r}).then(function(e){return e.blob()});case 7:l=e.sent,c=window.URL.createObjectURL(l),(h=document.createElement("a")).style.display="none",h.href=c,h.download=s,document.body.appendChild(h),h.click(),window.URL.revokeObjectURL(c),document.body.removeChild(h);case 17:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();function _asyncToGenerator$1(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){return function i(s,o){try{var a=t[s](o),r=a.value}catch(e){return void n(e)}if(!a.done)return Promise.resolve(r).then(function(e){i("next",e)},function(e){i("throw",e)});e(r)}("next")})}}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var MAX_SCALE=5,MIN_SCALE=.1,Previewer=function(){function e(){var t=this;_classCallCheck(this,e),this.previewing=!1,this.lastPreviewedAt=null,this.urls=[],this.stepCurrent=1,this.allSteps=1,this.getElement=function(e){return dom.$(e)},this.getOriginElement=function(e){return dom.$('img[src="'+e+'"]')||dom.$('img[data-src="'+e+'"]')||dom.$('img[data-hd="'+e+'"]')},this.getSource=function(e){return e.src||e.getAttribute("data-src")||e.getAttribute("data-hd")},this.getContainer=function(){var e="data-preview-container",n=dom.$('div[data-preview-container="true"]');if(n)return{$box:t.$container,$image:t.$imageContainer,$mask:t.$maskContainer,$loading:t.$loading};(n=t.$container=document.createElement("div")).className="previewer",n.setAttribute(e,"true"),dom.setStyles(n,{position:"fixed",top:0,left:0,width:"100%",height:"100%",zIndex:1e8,backgroundColor:"#000",overflow:"hidden",animation:"easeshow .4s",display:"flex",justifyContent:"center",alignItems:"center",transition:"all .3s"});var i=document.createElement("style");i.innerHTML="\n      @keyframes easeshow {\n        from {\n          opacity: 0;\n          transform: scale3d(0.3, 0.3, 0.3);\n        }\n\n        50% {\n          opacity: 1;\n        }\n      }\n      @keyframes easehide {\n        from {\n          opacity: 1;\n        }\n\n        50% {\n          opacity: 0;\n          transform: scale3d(0.3, 0.3, 0.3);\n        }\n\n        to {\n          opacity: 0;\n        }\n      }\n\n      div["+e+'="true"] img {\n        position: relative;\n      }\n\n      div['+e+'="true"] img:after {\n        content: "...";\n        position: absolute;\n        top: 50%;\n        left: 50%;\n        transform: translate3d(-50%, -50%, 0);\n      }\n\n      .pswp * {\n        box-sizing: border-box;\n      }\n\n      .pswp-toolbar-content {\n        display: flex;\n        align-items: center;\n        background: #252525;\n      }\n\n      .pswp-toolbar-content .group {\n        display: flex;\n        align-items: center;\n        background: #252525;\n        border-radius: 4px;\n        padding: 6px;\n      }\n\n      .pswp .lake-pswp-tool-bar .btn {\n        color: #D9D9D9;\n        display: inline-block;\n        width: 32px;\n        height: 32px;\n        padding: 6px;\n        margin: 0 6px;\n        border: 1px solid #383838;\n        border-radius: 2px;\n        cursor: pointer;\n\n        display: flex;\n        align-items: center;\n      }\n\n      .pswp .lake-pswp-tool-bar .lake-pswp-arrow-left,.lake-pswp-arrow-right {\n        padding: 8px;\n      }\n\n      .pswp .lake-pswp-tool-bar .pswp-toolbar-content .lake-pswp-counter {\n        user-select: none;\n        display: inline-block;\n        font-size: 16px;\n        vertical-align: top;\n        line-height: 34px;\n        color: #DEDEDE;\n        margin: 0 2px;\n        min-width: 37px;\n      }\n\n      .pswp .lake-pswp-tool-bar .separation {\n        width: 1px;\n        margin: 0px 10px;\n        display: inline-block;\n        height: 20px;\n        border: 0.5px solid #383838;\n      }\n\n      .pswp .lake-pswp-tool-bar .btn.disable {\n        background: none;\n      }\n\n      .previewer .icon {\n        width: 1em;\n        height: 1em;\n        vertical-align: -0.15em;\n        fill: currentColor;\n        overflow: hidden;\n      }\n\n      .previewer .close {\n        position: fixed;\n        top: 32px;\n        right: 32px;\n        width: 40px;\n        height: 40px;\n\n        color: #fff;\n        font-size: 20px;\n\n        background-color: #3c3c3c;\n\n        display: flex;\n        justify-content: center;\n        align-items: center;\n\n        transition: all .3s;\n\n        opacity: 0;\n\n        border-radius: 2px;\n      }\n\n      .previewer .close:hover {\n        cursor: pointer;\n      }\n\n      .previewer .toolbox {\n        opacity: 0;\n      }\n\n      .previewer:hover .close {\n        opacity: 1;\n      }\n\n      .previewer:hover .toolbox {\n        opacity: 1;\n      }\n\n      // @media (min-width: 1024px) {\n      //   .previewer .close {\n      //     opacity: 1;\n      //   }\n      // }\n\n      @media (max-width: 600px) {\n        .pswp-toolbar-content {\n          background: transparent;\n          flex-flow: column wrap;\n        }\n\n        .pswp-toolbar-content .separation {\n          display: none !important;\n        }\n\n        .pswp-toolbar-content .group {\n          margin-bottom: 6px;\n        }\n      }\n    ',n.prepend(i);var s=document.createElement("div");s.className="previewer-image-container-wrapper",dom.setStyles(s,{height:"100vh",display:"flex",justifyContent:"center",alignItems:"center"});var o=t.$imageContainer=document.createElement("img");o.className="previewer-image-container",o.setAttribute("rate",window.innerHeight/window.innerWidth),dom.setStyles(o,{width:"100%",border:"none",cursor:"move"}),t.createAlloyFinger(o),s.appendChild(o),n.appendChild(s);var a=t.$maskContainer=document.createElement("div");a.setAttribute("data-mask","true"),dom.setStyles(a,{position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:"-10","-webkit-tap-highlight-color":"rgba(0, 0, 0, 0)"}),n.prepend(a);var r=t.$loading=createLoading();n.appendChild(r);var l=t.createToolBox();n.appendChild(l);var c=t.createClose();return n.appendChild(c),t.useIconFontCN("//at.alicdn.com/t/font_1508774_y6eqn0d1ta.js"),dom.addEvents(a,["click","tap"],t.togglePreview),document.body.appendChild(n),dom.addEvents(o,["click"],function(e){e.stopPropagation()}),dom.addEvents(dom.$(".previewer .toolbox .lake-pswp-arrow-left"),["click"],t.previewPrevious),dom.addEvents(dom.$(".previewer .toolbox .lake-pswp-arrow-right"),["click"],t.previewNext),dom.addEvents(dom.$(".previewer .lake-pswp-zoom-in"),["click"],t.zoomIn),dom.addEvents(dom.$(".previewer .lake-pswp-zoom-out"),["click"],t.zoomOut),dom.addEvents(dom.$(".previewer .lake-pswp-rotate-left"),["click"],t.rotateLeft),dom.addEvents(dom.$(".previewer .lake-pswp-rotate-right"),["click"],t.rotateRight),dom.addEvents(dom.$(".previewer .lake-pswp-origin-size"),["click"],t.reset),dom.addEvents(dom.$(".previewer .close"),["tap","click"],t.close),{$box:n,$image:o,$mask:a,$loading:r}},this.setUrls=function(e){t.urls=e||[]},this.setSteps=function(e){var n=t.urls,i=n.indexOf(e);if(-1===i)return t.setUrls([e]),t.stepCurrent=1,void(t.allSteps=1);t.stepCurrent=i+1,t.allSteps=n.length},this.createIcon=function(e){return'\n      <svg class="icon" aria-hidden="true">\n        <use xlink:href="#previewer-'+e+'"></use>\n      </svg>\n    '},this.createClose=function(){var e=document.createElement("span")||document.querySelector(".previewer.close");return e.className="close",e.innerHTML=t.createIcon("close"),e},this.createToolBox=function(){var e=document.createElement("div")||document.querySelector(".toolbox.pswp");return e.className="toolbox pswp",e.style="position: fixed; bottom:0;left:50%;transform:translateX(-50%);padding:12px;transition:all .3s;",e.innerHTML='\n      <div class="lake-pswp-tool-bar">\n        <div class="pswp-toolbar-content">\n          <div class="group">\n            <span class="lake-pswp-arrow-left btn default">\n              '+t.createIcon("go-left")+'\n            </span>\n            <span class="lake-pswp-counter">'+t.stepCurrent+" / "+t.allSteps+'</span>\n            <span class="lake-pswp-arrow-right btn default">\n              '+t.createIcon("go-right")+'\n            </span>\n          </div>\n          <span class="separation"></span>\n          <div class="group">\n            <span class="lake-pswp-zoom-in btn default">\n              '+t.createIcon("zoom-in")+'\n            </span>\n            <span class="lake-pswp-zoom-out btn default">\n              '+t.createIcon("zoom-out")+'\n            </span>\n            <span class="lake-pswp-origin-size btn activated">\n              '+t.createIcon("1v1")+'\n            </span>\n            <span class="lake-pswp-rotate-left btn default">\n              '+t.createIcon("rotate-left")+'\n            </span>\n            <span class="lake-pswp-rotate-right btn default">\n              '+t.createIcon("rotate-right")+'\n            </span>\n          </div>\n          \x3c!-- <span class="lake-pswp-best-size btn disable">\n          '+t.createIcon("fullscreen")+"\n        </span> --\x3e\n        </div>\n      </div>\n    ",e},this.updateToolBox=function(){var e=dom.$(".toolbox .lake-pswp-counter");e&&(e.textContent=t.stepCurrent+" / "+t.allSteps)},this.createAlloyFinger=function(e){Transform(e);var n=1;return new AlloyFinger(e,{singleTap:function(){},doubleTap:function(){var n=1;n="width"===maxImage(e).auto?window.innerWidth/e.width:window.innerHeight/e.height,t.zoom(n)},multipointStart:function(){To.stopAll(),n=e.scaleX},multipointEnd:function(){To.stopAll(),e.scaleX<1&&(new To(e,"scaleX",1,500,ease),new To(e,"scaleY",1,500,ease)),e.scaleX>5&&(new To(e,"scaleX",5,500,ease),new To(e,"scaleY",5,500,ease));var t=e.rotateZ%360;t<0&&(t=360+t),e.rotateZ=t,t>0&&t<45?new To(e,"rotateZ",0,500,ease):t>=315?new To(e,"rotateZ",360,500,ease):t>=45&&t<135?new To(e,"rotateZ",90,500,ease):t>=135&&t<225?new To(e,"rotateZ",180,500,ease):t>=225&&t<315&&new To(e,"rotateZ",270,500,ease)},pinch:function(t){e.scaleX=e.scaleY=n*t.zoom},rotate:function(t){e.rotateZ+=t.angle},pressMove:function(n){t.checkBoundary(n.deltaX,n.deltaY)&&(e.translateX+=n.deltaX,e.translateY+=n.deltaY),n.preventDefault()}})},this.loadImage=function(e,t){var n=new Image;n.src=e,n.onload=function(){t(e)}},this.togglePreview=function(e){if(t.lastPreviewedAt&&Date.now()-t.lastPreviewedAt<300)return t.lastPreviewedAt=Date.now(),!1;t.lastPreviewedAt=Date.now(),!t.previewing&&e?(dom.addEvents(window,["keydown"],t.keyboardLeftRight),t.preview(e)):(dom.removeEvents(window,["keydown"],t.keyboardLeftRight),t.unpreview())},this.preview=function(e){var n=e||{},i=n.styles,s=n.source,o=n.index,a=void 0===o?0:o,r=s||t.urls[a];if(!r)return alert("No image source provided.");t.previewing=!0;var l=t.getContainer(),c=l.$box,h=l.$image,p=l.$loading;t.bodyScroll.disable(),dom.setStyles(c,{display:"flex"}),h.setAttribute("src","");var u=setTimeout(function(){dom.setStyles(p,{display:"block"})},300);t.setSteps(r),t.updateToolBox(),t.loadImage(r,function(e){if(h.setAttribute("src",e),i)dom.setStyles(h,i);else{var n=t.getOriginElement(r);if(n){var s,o=maxImage(n),a=o.max,l=o.auto;dom.setStyles(h,(_defineProperty(s={},a,"100%"),_defineProperty(s,l,"auto"),s))}}u&&(clearTimeout(u),u=null),dom.setStyles(p,{display:"none"})})},this.unpreview=function(){t.previewing=!1;var e=t.getContainer().$box;t.bodyScroll.enable(),t.reset(),dom.setStyles(e,{"animation-name":"easehide"});dom.addEvents(e,["animationend"],function t(){"easehide"===e.style["animation-name"]&&dom.setStyles(e,{display:"none","animation-name":"easeshow"}),dom.removeEvents(e,["animationend",t])})},this.previewNext=function(){t.stepCurrent+=1,t.stepCurrent>t.allSteps&&(t.stepCurrent=1);var e=t.stepCurrent-1,n=t.urls[e];t.reset(),t.preview({source:n})},this.previewPrevious=function(){t.stepCurrent-=1,t.stepCurrent<=0&&(t.stepCurrent=t.allSteps);var e=t.stepCurrent-1,n=t.urls[e];t.reset(),t.preview({source:n})},this.zoomIn=function(){var e=t.getContainer().$image;t.zoom(2*e.scaleX)},this.zoomOut=function(){var e=t.getContainer().$image;t.zoom(.5*e.scaleX)},this.rotateLeft=function(){var e=t.getContainer().$image.rotateZ,n=90*Math.ceil(e/90)-90;t.rotate(n)},this.rotateRight=function(){var e=t.getContainer().$image.rotateZ,n=90*Math.ceil(e/90)+90;t.rotate(n)},this.zoom=function(e){var n=t.getContainer().$image;To.stopAll(),n.scaleX>MAX_SCALE||n.scaleX<MIN_SCALE?(new To(n,"scaleX",1,500,ease),new To(n,"scaleY",1,500,ease),new To(n,"translateX",0,500,ease),new To(n,"translateY",0,500,ease)):(new To(n,"scaleX",e,500,ease),new To(n,"scaleY",e,500,ease),new To(n,"translateX",0,500,ease),new To(n,"translateY",0,500,ease))},this.rotate=function(e){var n=t.getContainer().$image;To.stopAll(),new To(n,"rotateZ",e,500,ease)},this.close=function(){t.unpreview()},this.checkBoundary=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=t.getContainer().$image,s=i.scaleX,o=i.translateX,a=i.translateY,r=i.originX,l=i.originY,c=i.width,h=i.height,p=i.getAttribute("rate");if((1!==s||s!==p)&&(o+e<=(s-1)*(c/2+r)+r&&o+e>=-(s-1)*(c/2-r)+r&&a+n<=(s-1)*(h/2+l)+l&&a+n>=-(s-1)*(h/2-l)+l))return!0;return!1},this.reset=function(){var e=t.getContainer().$image;To.stopAll(),1!==e.scaleX||1!==e.scaleY||0!==e.translateX||0!==e.translateY||0!==e.translateZ?(new To(e,"scaleX",1,500,ease),new To(e,"scaleY",1,500,ease),new To(e,"translateX",0,500,ease),new To(e,"translateY",0,500,ease),new To(e,"rotateX",0,500,ease),new To(e,"rotateY",0,500,ease),new To(e,"rotateZ",0,500,ease)):setTimeout(function(){To.reset(e,"scaleX",1),To.reset(e,"scaleY",1),To.reset(e,"translateX",0),To.reset(e,"translateY",0),To.reset(e,"rotateX",0),To.reset(e,"rotateY",0),To.reset(e,"rotateZ",0)},250)},this.render=function(){t.bodyScroll=createBodyScrollable();dom.addEvents(window,["tap","click"],function(e){var n,i=e.target;if(!t.previewable(i))return!1;if(!t.urls||!t.urls.length){var s=Array.prototype.slice.call(document.querySelectorAll('[data-preview="true"]')).map(function(e){return t.getSource(e)});t.setUrls(s)}var o=t.getSource(i),a=maxImage(i),r=a.max,l=a.auto;t.togglePreview({styles:(n={},_defineProperty(n,r,"100%"),_defineProperty(n,l,"auto"),n),source:o})})},this.keyboardLeftRight=function(e){var n=e.keyCode;37===n?t.previewPrevious():39===n&&t.previewNext()},this.render()}return _createClass(e,[{key:"previewable",value:function(e){return!!e.hasAttribute("data-preview")&&!!this.getSource(e)}},{key:"setContainerStyles",value:function(e){e&&dom.setStyles(this.$container,e)}},{key:"setImageStyles",value:function(e){e&&dom.setStyles(this.$image,e)}},{key:"useIconFontCN",value:function(e){var t=document.createElement("script");t.src=e,document.head.appendChild(t)}},{key:"download",value:function(){var e=_asyncToGenerator$1(_regeneratorRuntime.mark(function e(t){return _regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,download(t.url,t);case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}(),previewer=new Previewer;exports.previewer=previewer,exports.default=previewer;
